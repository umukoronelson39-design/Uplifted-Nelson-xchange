<div id="auth-screen" class="box">
    <div class="logo-circle">NX</div>
    <h2 id="auth-title">Nelson Xchange</h2>
    
    <input id="email" type="email" placeholder="Email Address">
    <input id="password" type="password" placeholder="Password">
    
    <div id="login-actions">
        <button class="login-btn" onclick="login()">Enter Dashboard</button>
        <p style="font-size: 12px; color: var(--text-muted);">New here? 
            <span onclick="toggleAuth(true)" style="color: var(--primary); cursor: pointer; font-weight: 700;">Create Account</span>
        </p>
    </div>

    <div id="register-actions" style="display:none;">
        <button class="login-btn" style="background: var(--success);" onclick="register()">Create My Account</button>
        <p style="font-size: 12px; color: var(--text-muted);">Already have one? 
            <span onclick="toggleAuth(false)" style="color: var(--primary); cursor: pointer; font-weight: 700;">Sign In</span>
        </p>
    </div>
</div>

<script>
    // --- NEW AUTHENTICATION FUNCTIONS ---

    // Switch between Login and Register views
    function toggleAuth(isRegister) {
        document.getElementById('auth-title').innerText = isRegister ? "Join Nelson Xchange" : "Nelson Xchange";
        document.getElementById('login-actions').style.display = isRegister ? "none" : "block";
        document.getElementById('register-actions').style.display = isRegister ? "block" : "none";
    }

    // Register a new user in Backendless
    function register() {
        const email = document.getElementById("email").value;
        const pass = document.getElementById("password").value;

        if (!email || !pass) return alert("Please fill in all fields");

        const user = new Backendless.User();
        user.email = email;
        user.password = pass;
        user.balance = 0; // Explicitly set starting balance

        Backendless.UserService.register(user)
            .then(res => {
                alert("Account created successfully! You can now sign in.");
                toggleAuth(false); // Send them back to login
            })
            .catch(err => {
                alert("Registration Failed: " + err.message);
            });
    }

    // Keep your existing login() function, but ensure it handles the balance correctly
    function login() {
        const email = document.getElementById("email").value;
        const pass = document.getElementById("password").value;

        Backendless.UserService.login(email, pass, true)
            .then(user => {
                userEmail = user.email;
                currentBalance = Number(user.balance || 0);
                
                // Admin check remains the same
                const checkAdmin = user.isAdmin || user.IsAdmin || false;
                if (checkAdmin === true) {
                    document.getElementById('admin-tab-btn').style.display = 'block';
                }

                document.getElementById("auth-screen").style.display = "none";
                document.getElementById("dashboard-screen").style.display = "block";
                updateBalanceDisplay(currentBalance);
                refreshHistory();
            })
            .catch(err => alert("Login Error: " + err.message));
    }
</script>
